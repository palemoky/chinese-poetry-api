---
# 方案 3: 使用 Kubernetes Service 名称（推荐）
# 不需要硬编码 IP

# 1. 在 Master 节点创建 NFS Service
apiVersion: v1
kind: Service
metadata:
  name: nfs-server
  namespace: kube-system
spec:
  type: ClusterIP
  clusterIP: None # Headless Service
  ports:
    - port: 2049
      protocol: TCP
  selector:
    node-role.kubernetes.io/control-plane: ""

---
# 2. 创建 Endpoints 指向 Master 节点
apiVersion: v1
kind: Endpoints
metadata:
  name: nfs-server
  namespace: kube-system
subsets:
  - addresses:
      - ip: 192.168.64.2 # 这里仍需要 IP，但只需要配置一次
    ports:
      - port: 2049

---
# 3. PV 使用 Service 名称（不需要 IP）
apiVersion: v1
kind: PersistentVolume
metadata:
  name: poetry-data-pv-nfs
spec:
  capacity:
    storage: 5Gi
  accessModes:
    - ReadWriteMany
  nfs:
    server: nfs-server.kube-system.svc.cluster.local # ✅ 使用 DNS 名称
    path: "/mnt/data/poetry-api"
